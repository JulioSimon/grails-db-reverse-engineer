<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Database Reverse Engineering Plugin 3.0.0</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction to the DB Reverse Engineering Plugin</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#configuration"><strong>3</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#generalUsage"><strong>4</strong><span>General Usage</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#tutorial"><strong>5</strong><span>Tutorial</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p>Reverse-engineers a database to Grails domain classes.</p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>Database Reverse Engineering Plugin - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Burt Beckwith</p>
                            <p><strong>Version:</strong> 3.0.0</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction to the DB Reverse Engineering Plugin</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#configuration"><strong>3</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#generalUsage"><strong>4</strong><span>General Usage</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#tutorial"><strong>5</strong><span>Tutorial</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction to the DB Reverse Engineering Plugin</h1>
The DB Reverse Engineering plugin reads database table information using JDBC and uses the schema data to create domain classes. This is a complex problem and the plugin is unlikely to get things 100% correct. But it should save you a lot of work and hopefully not require too much tweaking after the domain classes are generated.<p class="paragraph"/>The 3.x.x versions of the plugin work with Hibernate 3. If you're using Hibernate 4, use the latest version 4.x.x of the plugin.<p class="paragraph"/>The plugin uses the <a href="http://hibernate.org/tools/" target="blank">Hibernate Tools</a> library, with custom code to generate GORM domain classes instead of Java POJOs.



<h1 id="gettingStarted">2 Getting Started</h1>
<h4>The first step is installing the plugin. Add a plugin dependency in BuildConfig.groovy:</h4><p class="paragraph"/><div class="code"><pre>plugins &#123;
   runtime ':db&#45;reverse&#45;engineer:3.0.0'
&#125;</pre></div><p class="paragraph"/>There are no required initialization steps but there are some configuration options described in the <a href="../guide/single.html#configuration" class="guide">next section</a>.



<h1 id="configuration">3 Configuration</h1>
There are several configuration options for the plugin.<p class="paragraph"/><h4>Core properties</h4><p class="paragraph"/>These configuration options are the one you're most likely need to set. They include the package name of the generated files (<code>grails.plugin.reveng.packageName</code>), and information about which side of a many-to-many is the 'belongsTo' side (<code>grails.plugin.reveng.manyToManyBelongsTos</code>).<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>grails.plugin.reveng.packageName</td><td>application name</td><td>package name for the generated domain classes</td></tr><tr class="table-even"><td>grails.plugin.reveng.manyToManyBelongsTos</td><td>none</td><td>a Map of join table name -&#62; belongsTo table name to specify which of the two domain classes is the 'belongsTo' side of the relationship</td></tr></table><p class="paragraph"/><h4>Inclusion/exclusion properties</h4><p class="paragraph"/>These configuration options let you define which tables and columns to include in processing. By default all tables and columns are processed.<p class="paragraph"/>If you specify tables to include (<code>g.p.r.includeTables</code>, <code>g.p.r.includeTableRegexes</code>, and/or <code>g.p.r.includeTableAntPatterns</code>) then only those will be used. If you specify any of these options then all of the table exclusion options are ignored; this is useful when you have already run the reverse engineer script but want to re-run it for only a subset of tables.<p class="paragraph"/>If you specify tables to exclude (<code>g.p.r.excludeTables</code>, <code>g.p.r.excludeTableRegexes</code>, and/or <code>g.p.r.excludeTableAntPatterns</code>) then any matching tables will be ignored.<p class="paragraph"/>You can also specify columns to exclude (<code>g.p.r.excludeColumns</code>, <code>g.p.r.excludeColumnRegexes</code>, and/or <code>g.p.r.excludeColumnAntPatterns</code>) and any matching columns will be ignored. These options can be used with table include rules or table exclude rules - any tables that are included or not excluded will have their columns included or excludede based on these rules.<p class="paragraph"/>One addition property, <code>grails.plugin.reveng.manyToManyTables</code>, doesn't affect whether a table is processed, but rather determines whether a table that won't look like a many-to-many table to the Hibernate Tools library (because it has more than two columns) is considered a many-to-many table.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>grails.plugin.reveng.includeTables</td><td>none</td><td>a List of table names to include for processing</td></tr><tr class="table-even"><td>grails.plugin.reveng.includeTableRegexes</td><td>none</td><td>a List of table name regex patterns to include for processing</td></tr><tr class="table-odd"><td>grails.plugin.reveng.includeTableAntPatterns</td><td>none</td><td>a List of table name Ant-style patterns to include for processing</td></tr><tr class="table-even"><td>grails.plugin.reveng.excludeTables</td><td>none</td><td>a List of table names to exclude from processing</td></tr><tr class="table-odd"><td>grails.plugin.reveng.excludeTableRegexes</td><td>none</td><td>a List of table name regex patterns to exclude from processing</td></tr><tr class="table-even"><td>grails.plugin.reveng.excludeTableAntPatterns</td><td>none</td><td>a List of table name Ant-style patterns to exclude from processing</td></tr><tr class="table-odd"><td>grails.plugin.reveng.excludeColumns</td><td>none</td><td>a Map of table name -&#62; List of column names to ignore</td></tr><tr class="table-even"><td>grails.plugin.reveng.excludeColumnRegexes</td><td>none</td><td>a Map of table name -&#62; List of column name regex patterns to ignore</td></tr><tr class="table-odd"><td>grails.plugin.reveng.excludeColumnAntPatterns</td><td>none</td><td>a Map of table name -&#62; List of column name Ant-style patterns to ignore</td></tr><tr class="table-even"><td>grails.plugin.reveng.manyToManyTables</td><td>none</td><td>a List of table names that should be considered many-to-many join tables; needed for join tables that have more columns than the two foreign keys</td></tr></table><p class="paragraph"/><h4>Other properties</h4><p class="paragraph"/>These remaining configuration options allow you to specify the folder where the domain classes are generated (<code>g.p.r.destDir</code>), whether to overwrite existing classes (<code>g.p.r.overwriteExisting</code>) and non-standard 'version' column names (<code>g.p.r.versionColumns</code>).<p class="paragraph"/>There are also properties to set the default schema name (<code>g.p.r.defaultSchema</code>) and catalog (<code>g.p.r.defaultCatalog</code>) name which are useful when working with Oracle.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>grails.plugin.reveng.destDir</td><td>'grails-app/domain'</td><td>destination folder for the generated classes, relative to the project root</td></tr><tr class="table-even"><td>grails.plugin.reveng.versionColumns</td><td>none</td><td>a Map of table name -&#62; version column name, for tables with an optimistic locking column that's not named 'version'</td></tr><tr class="table-odd"><td>grails.plugin.reveng.overwriteExisting</td><td><code>true</code></td><td>whether to overwrite existing domain classes</td></tr><tr class="table-even"><td>grails.plugin.reveng.defaultSchema</td><td>none</td><td>the default database schema name</td></tr><tr class="table-odd"><td>grails.plugin.reveng.defaultCatalog</td><td>none</td><td>the default database catalog name</td></tr></table>



<h1 id="generalUsage">4 General Usage</h1>
It's most convenient when creating an application to also create the database at the same time. When creating a "greenfield" application like this you can let Hibernate create your tables for you (e.g. using a <code>dbCreate</code> value of <code>create-drop</code> or <code>update</code>). But often the database already exists, and creating GORM domain classes from them can be a tedious process.<p class="paragraph"/>This plugin will save you a lot of time by using the JDBC metadata API to inspect your database schema and create domain classes for you, using some assumptions and augmented by configuration options that you set.<p class="paragraph"/>The core of the plugin is the <a href="../ref/Scripts/db-reverse-engineer.html" class="Scripts">db-reverse-engineer</a> script. There are too many configuration options to support specifying them when running the script, so it takes no arguments and uses configuration options set in <code>grails-app/conf/Config.groovy</code>. These are described in the configuration.<p class="paragraph"/><h4>Environments</h4><p class="paragraph"/>You can choose which database to read from by specifying the environment when running the script (like any Grails script). For example to use the development environment settings, just run<p class="paragraph"/><div class="code"><pre>grails db&#45;reverse&#45;engineer</pre></div><p class="paragraph"/>To use the production environment settings, run<p class="paragraph"/><div class="code"><pre>grails prod db&#45;reverse&#45;engineer</pre></div><p class="paragraph"/>And if you want to use a custom 'staging' environment configured in <code>DataSource.groovy</code>, run<p class="paragraph"/><div class="code"><pre>grails &#45;Dgrails.env=staging db&#45;reverse&#45;engineer</pre></div><p class="paragraph"/><h4>Re-running the reverse engineering script</h4><p class="paragraph"/>If you have new or changed tables you can re-run the <a href="../ref/Scripts/db-reverse-engineer.html" class="Scripts">db-reverse-engineer</a> script to pick up changes and additions. This is not an incremental process though, so existing classes will be overwritten and you will lose any changes you made since the last run. But it's simple to define which tables to include or exclude.<p class="paragraph"/>As described in <a href="../guide/single.html#configuration" class="guide">the configuration section</a>, you can use a combination of the <code>grails.plugin.reveng.includeTables</code>, <code>grails.plugin.reveng.includeTableRegexes</code>, <code>grails.plugin.reveng.includeTableAntPatterns</code>, <code>grails.plugin.reveng.excludeTables</code>, <code>grails.plugin.reveng.excludeTableRegexes</code>, and <code>grails.plugin.reveng.excludeTableAntPatterns</code> properties to define which tables to include or exclude.<p class="paragraph"/>By default all tables are included, and the plugin assumes you're more likely to exclude than include. So you can specify one or more table names to explicitly exclude using <code>grails.plugin.reveng.excludeTables</code>, one or more regex patterns for exclusion using <code>grails.plugin.reveng.excludeTableRegexes</code>, and one or more Ant-style patterns for exclusion using <code>grails.plugin.reveng.excludeTableAntPatterns</code>.<p class="paragraph"/>For example, using this configuration<p class="paragraph"/><div class="code"><pre>grails.plugin.reveng.excludeTables = &#91;'clickstream', 'error_log'&#93;
grails.plugin.reveng.excludeTableRegexes = &#91;'temp.+'&#93;
grails.plugin.reveng.excludeTableAntPatterns = &#91;'audit_&#42;'&#93;</pre></div><p class="paragraph"/>you would process all tables except <code>clickstream</code> and <code>error_log</code>, and any tables that start with 'temp' (e.g. <code>tempPerson</code>, <code>tempOrganization</code>, etc.) and any tables that start with 'audit_' (e.g. 'audit_orders', 'audit_order_items', etc.)<p class="paragraph"/>If you only want to include one or a few tables, it's more convenient to specify inclusion rules rather than exclusion rules, so you use <code>grails.plugin.reveng.includeTables</code>, <code>grails.plugin.reveng.includeTableRegexes</code>, and <code>grails.plugin.reveng.includeTableAntPatterns</code> for that. If any of these properties are set, the table exclusion rules are ignored.<p class="paragraph"/>For example, using this configuration<p class="paragraph"/><div class="code"><pre>grails.plugin.reveng.includeTables = &#91;'person', 'organization'&#93;</pre></div><p class="paragraph"/>you would process (or re-process) just the <code>person</code> and <code>organization</code> tables. You can also use The <code>grails.plugin.reveng.includeTableRegexes</code> and <code>grails.plugin.reveng.includeTableAntPatterns</code> properties to include tables based on patterns.<p class="paragraph"/>You can further customize the process by specifying which columns to exclude per-table. For example, this configuration<p class="paragraph"/><div class="code"><pre>grails.plugin.reveng.excludeColumns = &#91;'some_table': &#91;'col1', 'col2'&#93;,
                                       'another_table': &#91;'another_column'&#93;&#93;</pre></div><p class="paragraph"/>will exclude columns <code>col1</code> and <code>col2</code> from table <code>some_table</code>, and column <code>another_column</code> from table <code>another_table</code>.<p class="paragraph"/>You can also use the <code>grails.plugin.reveng.excludeColumnRegexes</code> and <code>grails.plugin.reveng.excludeColumnAntPatterns</code> properties to define patterns for columns to exclude.<p class="paragraph"/><h4>Destination folder</h4><p class="paragraph"/>By default the domain classes are generated under the <code>grails-app/domain</code> folder in the package specified. But you can override the destination, for example if you're re-running the process and want to compare the new classes with the previous ones.<p class="paragraph"/>By default the <code>db-reverse-engineer</code> script will overwrite existing classes. You can set the <code>grails.plugin.reveng.overwriteExisting</code> property to <code>false</code> to override this behavior and not overwrite existing files.<p class="paragraph"/><h4>Many-to-many tables</h4><p class="paragraph"/>Typically many-to-many relationships are implemented using a join table which contains just two columns which are foreign keys referring to the two related tables. It's possible for join tables to have extra columns though, and this will cause problems when trying to infer relationships. By default Hibernate will only consider tables that have two foreign key columns to be join tables. To get the script to correctly use join tables with extra columns, you can specify the table names with the <code>grails.plugin.reveng.manyToManyTables</code> property. This is demonstrated in <a href="../guide/single.html#tutorial" class="guide">the tutorial</a>.<p class="paragraph"/>Another problem with many-to-many relationships is that one of the two GORM classes needs to be the 'owning' side and the other needs to be the 'owned' side, but this cannot be reliably inferred from the database. Both classes need a <code>hasMany</code> declaration, but the 'owned' domain class also needs a <code>belongsTo</code> declaration. So all of your many-to-many related tables need to have the tables that will create the <code>belongsTo</code> classes specified in the <code>grails.plugin.reveng.manyToManyBelongsTos</code> property. This is demonstrated in <a href="../guide/single.html#tutorial" class="guide">the tutorial</a>.<p class="paragraph"/><h4>Optimistic locking columns</h4><p class="paragraph"/>Hibernate assumes that columns used for optimistic lock detection are called <code>version</code>. If you have customized one or more column names, you can direct the script about what the custom names are with the <code>grails.plugin.reveng.versionColumns</code> property. This is demonstrated in <a href="../guide/single.html#tutorial" class="guide">the tutorial</a>.<p class="paragraph"/><h4>Logging</h4><p class="paragraph"/>All of the plugin classes are in the <code>grails.plugin.reveng</code> package, so you can configure that package for logging to see generated messages.



<h1 id="tutorial">5 Tutorial</h1>
In this tutorial we'll create a MySQL database and generate domain classes from it.<p class="paragraph"/><h4>1. Create your Grails application.</h4><p class="paragraph"/><pre class="bq"><code>
$ grails create-app reveng-test
$ cd reveng-test</code></pre><p class="paragraph"/><h4>2. Install the plugin by adding a dependency in BuildConfig.groovy:</h4><p class="paragraph"/><div class="code"><pre>plugins &#123;
   &#8230;
   compile ':db&#45;reverse&#45;engineer:3.0.0'
   &#8230;
&#125;</pre></div><p class="paragraph"/><h4>3. Configure the development environment for MySQL.</h4><p class="paragraph"/>Set these property values in the <code>development</code> section of <code>grails-app/conf/DataSource.groovy</code><p class="paragraph"/><div class="code"><pre>dataSource &#123;
   &#8230;
   dialect = org.hibernate.dialect.MySQL5InnoDBDialect
   driverClassName = 'com.mysql.jdbc.Driver'
   password = 'reveng'
   url = 'jdbc:mysql://localhost/reveng'
   username = 'reveng'
   &#8230;
&#125;</pre></div><p class="paragraph"/>Also add a dependency for the MySQL JDBC driver in <code>grails-app/conf/BuildConfig.groovy</code>:<p class="paragraph"/><div class="code"><pre>dependencies &#123;
   runtime 'mysql:mysql&#45;connector&#45;java:5.1.38'
&#125;</pre></div><p class="paragraph"/>4. 4. Create the database.<p class="paragraph"/>As the root user or another user that has rights to create a database and configure grants, run<p class="paragraph"/><pre class="bq"><code>
create database reveng;
grant all on reveng.* to reveng&#64;localhost identified by 'reveng';</code></pre><p class="paragraph"/><h4>5. Create the database tables.</h4><p class="paragraph"/>Run these create and alter statements in the <code>reveng</code> database:<p class="paragraph"/><div class="code"><pre>use reveng;<p class="paragraph"/>CREATE TABLE author (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  name varchar(255) NOT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE book (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  title varchar(255) NOT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE author_books (
  author_id bigint(20) NOT NULL,
  book_id bigint(20) NOT NULL,
  PRIMARY KEY (author_id,book_id),
  KEY FK24C812F6183CFE1B (book_id),
  KEY FK24C812F6DAE0A69B (author_id),
  CONSTRAINT FK24C812F6183CFE1B FOREIGN KEY (book_id) REFERENCES book (id),
  CONSTRAINT FK24C812F6DAE0A69B FOREIGN KEY (author_id) REFERENCES author (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE compos (
  first_name varchar(255) NOT NULL,
  last_name varchar(255) NOT NULL,
  version bigint(20) NOT NULL,
  other varchar(255) NOT NULL,
  PRIMARY KEY (first_name,last_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE compound_unique (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  prop1 varchar(255) NOT NULL,
  prop2 varchar(255) NOT NULL,
  prop3 varchar(255) NOT NULL,
  prop4 varchar(255) NOT NULL,
  prop5 varchar(255) NOT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY prop4 (prop4,prop3,prop2)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE library (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  name varchar(255) NOT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE visit (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  library_id bigint(20) NOT NULL,
  person varchar(255) NOT NULL,
  visit_date datetime NOT NULL,
  PRIMARY KEY (id),
  KEY FK6B04D4BE8E8E739 (library_id),
  CONSTRAINT FK6B04D4BE8E8E739 FOREIGN KEY (library_id) REFERENCES library (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE other (
  username varchar(255) NOT NULL,
  nonstandard_version_name bigint(20) NOT NULL,
  PRIMARY KEY (username)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE user (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  account_expired bit(1) NOT NULL,
  account_locked bit(1) NOT NULL,
  enabled bit(1) NOT NULL,
  password varchar(255) NOT NULL,
  password_expired bit(1) NOT NULL,
  username varchar(255) NOT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY username (username)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE role (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  authority varchar(255) NOT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY authority (authority)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE user_role (
  role_id bigint(20) NOT NULL,
  user_id bigint(20) NOT NULL,
  date_updated datetime NOT NULL,
  PRIMARY KEY (role_id,user_id),
  KEY FK143BF46A667AF6FB (role_id),
  KEY FK143BF46ABA5BADB (user_id),
  CONSTRAINT FK143BF46A667AF6FB FOREIGN KEY (role_id) REFERENCES role (id),
  CONSTRAINT FK143BF46ABA5BADB FOREIGN KEY (user_id) REFERENCES user (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE thing (
  thing_id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  email varchar(255) NOT NULL,
  float_value <span class="java&#45;object">float</span> NOT NULL,
  name varchar(123) DEFAULT NULL,
  PRIMARY KEY (thing_id),
  UNIQUE KEY email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</pre></div><p class="paragraph"/><h4>6. Configure the reverse engineering process.</h4><p class="paragraph"/>Add these configuration options to <code>grails-app/conf/Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.reveng.packageName = 'com.revengtest'
grails.plugin.reveng.versionColumns = &#91;other: 'nonstandard_version_name'&#93;
grails.plugin.reveng.manyToManyTables = &#91;'user_role'&#93;
grails.plugin.reveng.manyToManyBelongsTos = &#91;'user_role': 'role', 'author_books': 'book'&#93;</pre></div><p class="paragraph"/><h4>7. Run the db-reverse-engineer script.</h4><p class="paragraph"/><pre class="bq"><code>
$ grails db-reverse-engineer</code></pre><p class="paragraph"/><h4>8. Look at the generated domain classes.</h4><p class="paragraph"/><h4>Author and Book domain classes.</h4><p class="paragraph"/>The <code>author</code> and <code>book</code> tables have a many-to-many relationship, which uses the <code>author_books</code> join table:<p class="paragraph"/><div class="code"><pre>CREATE TABLE author (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  name varchar(255) NOT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE book (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  title varchar(255) NOT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE author_books (
  author_id bigint(20) NOT NULL,
  book_id bigint(20) NOT NULL,
  PRIMARY KEY (author_id,book_id),
  KEY FK24C812F6183CFE1B (book_id),
  KEY FK24C812F6DAE0A69B (author_id),
  CONSTRAINT FK24C812F6183CFE1B FOREIGN KEY (book_id) REFERENCES book (id),
  CONSTRAINT FK24C812F6DAE0A69B FOREIGN KEY (author_id) REFERENCES author (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</pre></div><p class="paragraph"/>After running the script you'll have classes similar to these:<p class="paragraph"/><div class="code"><pre>class Author &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> name<p class="paragraph"/>   <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;
&#125;</pre></div><p class="paragraph"/>and<p class="paragraph"/><div class="code"><pre>class Book &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> title<p class="paragraph"/>   <span class="java&#45;keyword">static</span> hasMany = &#91;authors: Author&#93;
   <span class="java&#45;keyword">static</span> belongsTo = &#91;Author&#93;
&#125;</pre></div><p class="paragraph"/><code>Book</code> has the line <code>static belongsTo = Author</code> because we specified this in <code>Config.groovy</code> with the <code>grails.plugin.reveng.manyToManyBelongsTos</code> property.<p class="paragraph"/><h4>Compos domain class.</h4><p class="paragraph"/>The <code>compos</code> table has a composite primary key (made up of the <code>first_name</code> and <code>last_name</code> columns):<p class="paragraph"/><div class="code"><pre>CREATE TABLE compos (
  first_name varchar(255) NOT NULL,
  last_name varchar(255) NOT NULL,
  version bigint(20) NOT NULL,
  other varchar(255) NOT NULL,
  PRIMARY KEY (first_name,last_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</pre></div><p class="paragraph"/>and it generates this domain class:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.apache.commons.lang.builder.EqualsBuilder
<span class="java&#45;keyword">import</span> org.apache.commons.lang.builder.HashCodeBuilder<p class="paragraph"/>class Compos <span class="java&#45;keyword">implements</span> Serializable &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> firstName
   <span class="java&#45;object">String</span> lastName
   <span class="java&#45;object">String</span> other<p class="paragraph"/>   <span class="java&#45;object">int</span> hashCode() &#123;
      def builder = <span class="java&#45;keyword">new</span> HashCodeBuilder()
      builder.append firstName
      builder.append lastName
      builder.toHashCode()
   &#125;<p class="paragraph"/>   <span class="java&#45;object">boolean</span> equals(other) &#123;
      <span class="java&#45;keyword">if</span> (other == <span class="java&#45;keyword">null</span>) <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">false</span>
      def builder = <span class="java&#45;keyword">new</span> EqualsBuilder()
      builder.append firstName, other.firstName
      builder.append lastName, other.lastName
      builder.isEquals()
   &#125;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      id composite: &#91;<span class="java&#45;quote">"firstName"</span>, <span class="java&#45;quote">"lastName"</span>&#93;
   &#125;
&#125;</pre></div><p class="paragraph"/>Since it has a composite primary key, the class is its own primary key so it has to implement <code>Serializable</code> and implement <code>hashCode</code> and <code>equals</code>.<p class="paragraph"/><h4>CompoundUnique domain class.</h4><p class="paragraph"/>The <code>compound_unique</code> table has five properties, three of which are in a compound unique index:<p class="paragraph"/><div class="code"><pre>CREATE TABLE compound_unique (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  prop1 varchar(255) NOT NULL,
  prop2 varchar(255) NOT NULL,
  prop3 varchar(255) NOT NULL,
  prop4 varchar(255) NOT NULL,
  prop5 varchar(255) NOT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY prop4 (prop4,prop3,prop2)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</pre></div><p class="paragraph"/>and it generates this domain class:<p class="paragraph"/><div class="code"><pre>class CompoundUnique &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> prop1
   <span class="java&#45;object">String</span> prop2
   <span class="java&#45;object">String</span> prop3
   <span class="java&#45;object">String</span> prop4
   <span class="java&#45;object">String</span> prop5<p class="paragraph"/>   <span class="java&#45;keyword">static</span> constraints = &#123;
      prop2 unique: &#91;<span class="java&#45;quote">"prop3"</span>, <span class="java&#45;quote">"prop4"</span>&#93;
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>Library and Visit domain classes.</h4><p class="paragraph"/>The <code>library</code> and <code>visit</code> tables have a one-to-many relationship:<p class="paragraph"/><div class="code"><pre>CREATE TABLE library (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  name varchar(255) NOT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE visit (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  library_id bigint(20) NOT NULL,
  person varchar(255) NOT NULL,
  visit_date datetime NOT NULL,
  PRIMARY KEY (id),
  KEY FK6B04D4BE8E8E739 (library_id),
  CONSTRAINT FK6B04D4BE8E8E739 FOREIGN KEY (library_id) REFERENCES library (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</pre></div><p class="paragraph"/>and they generate these domain classes:<p class="paragraph"/><div class="code"><pre>class Library &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> name<p class="paragraph"/>   <span class="java&#45;keyword">static</span> hasMany = &#91;visits: Visit&#93;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class Visit &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> person
   Date visitDate
   Library library<p class="paragraph"/>   <span class="java&#45;keyword">static</span> belongsTo = &#91;Library&#93;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      version <span class="java&#45;keyword">false</span>
   &#125;
&#125;</pre></div><p class="paragraph"/><code>visit</code> has no <code>version</code> column, so the <code>Visit</code> has optimistic lock checking disabled (<code>version false</code>).<p class="paragraph"/><h4>Other domain class.</h4><p class="paragraph"/>The <code>other</code> table has a string primary key, and an optimistic locking column that's not named <code>version</code>. Since we configured this with the <code>grails.plugin.reveng.versionColumns</code> property, the column is resolved correctly:<p class="paragraph"/><div class="code"><pre>CREATE TABLE other (
  username varchar(255) NOT NULL,
  nonstandard_version_name bigint(20) NOT NULL,
  PRIMARY KEY (username)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</pre></div><p class="paragraph"/><div class="code"><pre>class Other &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> username<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      id name: <span class="java&#45;quote">"username"</span>, generator: <span class="java&#45;quote">"assigned"</span>
      version <span class="java&#45;quote">"nonstandard_version_name"</span>
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>User and Role domain classes.</h4><p class="paragraph"/>The <code>user</code> and <code>role</code> tables have a many-to-many relationship, which uses the <code>user_role</code> join table:<p class="paragraph"/><div class="code"><pre>CREATE TABLE user (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  account_expired bit(1) NOT NULL,
  account_locked bit(1) NOT NULL,
  enabled bit(1) NOT NULL,
  password varchar(255) NOT NULL,
  password_expired bit(1) NOT NULL,
  username varchar(255) NOT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY username (username)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE role (
  id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  authority varchar(255) NOT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY authority (authority)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;<p class="paragraph"/>CREATE TABLE user_role (
  role_id bigint(20) NOT NULL,
  user_id bigint(20) NOT NULL,
  date_updated datetime NOT NULL,
  PRIMARY KEY (role_id,user_id),
  KEY FK143BF46A667AF6FB (role_id),
  KEY FK143BF46ABA5BADB (user_id),
  CONSTRAINT FK143BF46A667AF6FB FOREIGN KEY (role_id) REFERENCES role (id),
  CONSTRAINT FK143BF46ABA5BADB FOREIGN KEY (user_id) REFERENCES user (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</pre></div><p class="paragraph"/>The <code>user_role</code> table has an extra column (<code>date_updated</code>) and would be ignored by default, but since we configured it with the <code>grails.plugin.reveng.manyToManyTables</code> property it's resolved correctly:<p class="paragraph"/><div class="code"><pre>class Role &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> authority<p class="paragraph"/>   <span class="java&#45;keyword">static</span> hasMany = &#91;users: User&#93;
   <span class="java&#45;keyword">static</span> belongsTo = &#91;User&#93;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> constraints = &#123;
      authority unique: <span class="java&#45;keyword">true</span>
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre>class User &#123;<p class="paragraph"/>   <span class="java&#45;object">Boolean</span> accountExpired
   <span class="java&#45;object">Boolean</span> accountLocked
   <span class="java&#45;object">Boolean</span> enabled
   <span class="java&#45;object">String</span> password
   <span class="java&#45;object">Boolean</span> passwordExpired
   <span class="java&#45;object">String</span> username<p class="paragraph"/>   <span class="java&#45;keyword">static</span> hasMany = &#91;roles: Role&#93;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> constraints = &#123;
      username unique: <span class="java&#45;keyword">true</span>
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>Thing domain class.</h4><p class="paragraph"/>The <code>thing</code> table has a non-standard primary key column (<code>thing_id</code>) and a unique constraint on the <code>email</code> column. The <code>name</code> column is nullable, and is defined as <code>varchar(123)</code>:<p class="paragraph"/><div class="code"><pre>CREATE TABLE thing (
  thing_id bigint(20) NOT NULL AUTO_INCREMENT,
  version bigint(20) NOT NULL,
  email varchar(255) NOT NULL,
  float_value <span class="java&#45;object">float</span> NOT NULL,
  name varchar(123) DEFAULT NULL,
  PRIMARY KEY (thing_id),
  UNIQUE KEY email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</pre></div><p class="paragraph"/>and it generates this domain class:<p class="paragraph"/><div class="code"><pre>class Thing &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> email
   <span class="java&#45;object">Float</span> floatValue
   <span class="java&#45;object">String</span> name<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      id column: <span class="java&#45;quote">"thing_id"</span>
   &#125;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> constraints = &#123;
      email unique: <span class="java&#45;keyword">true</span>
      name nullable: <span class="java&#45;keyword">true</span>, maxSize: 123
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>9. Update a table and re-run the script.</h4><p class="paragraph"/>Add a new column to the <code>thing</code> table:<p class="paragraph"/><pre class="bq"><code>
alter table thing add new_column boolean;</code></pre><p class="paragraph"/>We'll re-run the script but need to configure it to generate the updated domain class in a different directory from the default so we can compare with the original. To configure this, set the value of the <code>grails.plugin.reveng.destDir</code> property in <code>grails-app/conf/Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.reveng.destDir = 'temp_reverse_engineer'</pre></div><p class="paragraph"/>Also change the configuration to only include the <code>thing</code> table:<p class="paragraph"/><div class="code"><pre>grails.plugin.reveng.includeTables = &#91;'thing'&#93;</pre></div><p class="paragraph"/>Re-eun the db-reverse-engineer script:<p class="paragraph"/><pre class="bq"><code>
$ grails db-reverse-engineer</code></pre><p class="paragraph"/>The script will generate this domain class in the temp_reverse_engineer/com/revengtest folder:<p class="paragraph"/><div class="code"><pre>class Thing &#123;<p class="paragraph"/>   <span class="java&#45;object">String</span> email
   <span class="java&#45;object">Float</span> floatValue
   <span class="java&#45;object">String</span> name
   <span class="java&#45;object">Boolean</span> newColumn<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      id column: <span class="java&#45;quote">"thing_id"</span>
   &#125;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> constraints = &#123;
      email unique: <span class="java&#45;keyword">true</span>
      name nullable: <span class="java&#45;keyword">true</span>, maxSize: 123
      newColumn nullable: <span class="java&#45;keyword">true</span>
   &#125;
&#125;</pre></div><p class="paragraph"/>The domain class has a new <code>Boolean newColumn</code> field and a <code>nullable</code> constraint. Since this generated the correct changes it's safe to move replace the previous domain class with this one.


                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Scripts/db-reverse-engineer.html">db-reverse-engineer</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
